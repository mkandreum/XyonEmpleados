<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>XyonEmpleados | Portal del Empleado</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="apple-touch-icon" href="/pwa-192x192.png">
  <meta name="theme-color" content="#ffffff">
</head>

<body>
  <div id="root"></div>
  <!-- Session guard: runs BEFORE any cached JS bundle loads -->
  <script>
    (function () {
      // One-time cache bust when asset version changes
      var ASSET_VERSION = '2026-02-18-cal-nav';
      try {
        var stored = localStorage.getItem('asset_version');
        if (stored !== ASSET_VERSION) {
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (regs) {
              regs.forEach(function (r) { r.unregister(); });
            });
          }
          if ('caches' in window) {
            caches.keys().then(function (names) {
              names.forEach(function (n) { caches.delete(n); });
            });
          }
          localStorage.setItem('asset_version', ASSET_VERSION);
        }
      } catch (e) {
        console.warn('Cache version check failed', e);
      }

      try {
        var token = localStorage.getItem('token');
        if (token) {
          var parts = token.split('.');
          if (parts.length === 3) {
            var payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
            if (payload.exp && (payload.exp * 1000) < Date.now()) {
              // Token expired - clear session immediately
              localStorage.removeItem('token');
              localStorage.removeItem('user');
              if (window.location.pathname !== '/login' &&
                window.location.pathname !== '/register' &&
                window.location.pathname !== '/forgot-password' &&
                window.location.pathname !== '/reset-password') {
                window.location.replace('/login?expired=1');
              }
            }
          } else {
            // Invalid token format
            localStorage.removeItem('token');
            localStorage.removeItem('user');
          }
        }
      } catch (e) {
        // If anything fails, clear potentially corrupt session
        localStorage.removeItem('token');
        localStorage.removeItem('user');
      }

    })();
  </script>
  <script type="module" src="/index.tsx?v=__BUILD_VERSION__"></script>
</body>

</html>